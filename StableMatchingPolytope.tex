\documentclass[preprint]{elsarticle}
%\usepackage[margin=1in, bottom=1in, top=1in]{geometry} %1 inch margins
\usepackage{amsmath, amssymb, amstext}
\usepackage{fancyhdr}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{mathtools}
\usepackage{theorem}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary[topaths]
\usetikzlibrary{decorations.pathmorphing}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

%Theorem
\newtheorem{fact}{Fact}[section]
\newtheorem{lemma}[fact]{Lemma}
\newtheorem{theorem}[fact]{Theorem}
\newtheorem{definition}[fact]{Definition}
\newtheorem{corollary}[fact]{Corollary}
\newtheorem{proposition}[fact]{Proposition}
\newtheorem{claim}[fact]{Claim}
\newtheorem{exercise}[fact]{Exercise}
\newtheorem{note}[fact]{Note}
\newenvironment{proof}{{\bf Proof:  }}{\hfill\rule{2mm}{2mm}}
%Macros
\newcommand{\A}{\mathbb{A}} \newcommand{\C}{\mathbb{C}}
\newcommand{\D}{\mathbb{D}} \newcommand{\F}{\mathbb{F}}
\newcommand{\N}{\mathbb{N}} \newcommand{\R}{\mathbb{R}}
\newcommand{\T}{\mathbb{T}} \newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
 
 
\newcommand{\cA}{\mathcal{A}} \newcommand{\cB}{\mathcal{B}}
\newcommand{\cC}{\mathcal{C}} \newcommand{\cD}{\mathcal{D}}
\newcommand{\cE}{\mathcal{E}} \newcommand{\cF}{\mathcal{F}}
\newcommand{\cG}{\mathcal{G}} \newcommand{\cH}{\mathcal{H}}
\newcommand{\cI}{\mathcal{I}} \newcommand{\cJ}{\mathcal{J}}
\newcommand{\cK}{\mathcal{K}} \newcommand{\cL}{\mathcal{L}}
\newcommand{\cM}{\mathcal{M}} \newcommand{\cN}{\mathcal{N}}
\newcommand{\cO}{\mathcal{O}} \newcommand{\cP}{\mathcal{P}}
\newcommand{\cQ}{\mathcal{Q}} \newcommand{\cR}{\mathcal{R}}
\newcommand{\cS}{\mathcal{S}} \newcommand{\cT}{\mathcal{T}}
\newcommand{\cU}{\mathcal{U}} \newcommand{\cV}{\mathcal{V}}
\newcommand{\cW}{\mathcal{W}} \newcommand{\cX}{\mathcal{X}}
\newcommand{\cY}{\mathcal{Y}} \newcommand{\cZ}{\mathcal{Z}}


\DeclareMathOperator{\convOp}{conv}
\newcommand{\conv}{\convOp}


\begin{document}
\begin{frontmatter}
%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for the associated footnote;
%% use the fnref command within \author or \address for footnotes;
%% use the fntext command for the associated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for the associated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%%
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \address{Address\fnref{label3}}
%% \fntext[label3]{}

%% use optional labels to link authors explicitly to addresses:
%% \author[label1,label2]{<author name>}
%% \address[label1]{<address>}
%% \address[label2]{<address>}

\title{Linear Description for Stable Matching Polytope: Alternative Proof}
\author[co]{Jochen K\"{o}nemann}
\author[co]{Kanstantsin Pashkovich}
\author[co]{Justin Toth\corref{cor1}}
\ead{wjtoth@uwaterloo.ca}
\address[co]{Department of Combinatorics and Optimization, University of Waterloo, Canada}

\cortext[cor1]{Corresponding author}

\begin{abstract}
In this paper we provide an alternative proof for the description.
\end{abstract}
\begin{keyword}
Stable Matching\sep Polytope\sep Extreme Points
\end{keyword}
\end{frontmatter}
{\color{red}
\section*{TODO}
\begin{enumerate}
	\item introduction
	\item formulate the idea of the proofs by Rothblum and van Vate
	\item citation for structure of symmetric difference, adjacencies in the stable matching polytope
	\item pictures
	\item expand some explanations or make them clearer, if necessary
\end{enumerate}
}
\section{Stable Matching Structure}

Let $G = (V, E)$ be a bipartite graph  where the bipartition is given by node sets $\mathcal{A}$ and $\mathcal{B}$. Moreover, each node $a\in\mathcal{A}$ defines a total ordering $>_a$ on its neighbour nodes $N(a):=\{b \in\mathcal{B}: \{a,b\}\in E\}$;  the same holds for nodes in $\mathcal{B}$.

Let us introduce the following notation. For $a\in \mathcal{A}$ and $b \in N(\mathcal{A})$, we can define $\delta^{>b}(a):=\{ \{a,\beta\}\in E: \beta>_a b \}$. Similarly we can define $\delta^{>a}(b)$, $\delta^{\leq b}(a)$, $\delta^{\geq b}(a)$, etc. For $a\in \mathcal{A}$ let $N_{\max}(a)$ denote the maximum element in $N(a)$ with respect to $>_a$, analogously define $N_{\min}(a)$ and $N_{\max}(b)$, $N_{\min}(b)$ for $b\in\mathcal{B}$. 

Given a matching $M$ and $v\in V$, we define $M(v)$ as a neighbour of $v$ in $M$ if $v$ is matched by $M$, otherwise $M(v):=\varnothing$. To simplify notation we understand $>_v$, $v\in V$ as a total ordering on the set $N(v)\cup\{\varnothing\}$, where $\varnothing$ is the smallest element with respect to $>_v$.
A matching $M$ in $G$ is called a $\emph{stable matching}$ if for every edge $e=\{a,b\}\in E$ we have
\begin{equation}\label{eq:stability_def}
		M \, \cap \, \big(\delta^{>a}(b) \cup \delta^{>b}(a) \cup  \{e\} \big)\neq\varnothing\,,
\end{equation}
i.e. no edge $\{a,b\}\in E$ is absent in $M$  if $a>_b M(b)$ and $b>_a M(a)$.


The following lemmas study the connected components of $M_1\triangle M_2:=\{ e\in E: |M_1\cap \{e\}|+|M_2\cap \{e\}|=1\}$ for stable matchings $M_1$, $M_2$ in $G$. Here, $V(C)$ and $E(C)$ denote the node and edge sets of a graph $C$.

\begin{lemma}\label{lemma:pref}
Let $M_1$ and $M_2$ be two stable matchings in $G$ and let $C$ be a connected component in $M_1 \triangle M_2$. Then, either
\begin{equation}\label{eq:pref_first}
	M_1(a)>_a M_2(a)\,,\,\forall a\in V(C) \cap\mathcal{A}\quad \text{and} \quad  M_2(b)>_b M_1(b)\,,\,  \forall b\in V(C) \cap\mathcal{B}
\end{equation}
or 
\begin{equation}\label{eq:pref_second}
	M_2(a)>_a M_1(a)\,,\,\forall a\in V(C) \cap\mathcal{A}\quad \text{and} \quad  M_1(b)>_b M_2(b)\,,\,  \forall b\in V(C) \cap\mathcal{B}
\end{equation}
\end{lemma}


\begin{proof}
Since $M_1$ and $M_2$ are matchings, $C$ is a path or a cycle. Let $v\in V$ be an end node of $C$ if $C$ is a path, otherwise let $v$ be an arbitrary node of $C$. 

W.l.o.g. $v:=a\in \mathcal{A}$ and $b:=M_1(a) >_a M_2(a)$. If $a=M_1(b) >_b M_2(b)$, the matching $M_2$ violates~\eqref{eq:stability_def} for the edge $\{a,b\}\in E$. Thus, $M_2(b) >_b M_1(b)=a$. Thus, $M_2(b)\neq \varnothing$ and the matching $M_1$ satisfies~\eqref{eq:stability_def} for the edge $e:=\{b,M_2(b)\}\in E$ only if $M_1(M_2(b))>_{M_2(b)} b$. Continuing in this way, we obtain statement~\eqref{eq:pref_first}.
\end{proof}

\begin{figure}[H]
\centering
\begin{tikzpicture}
\node[] (J1) at (0,5) {$C$:};

\node[shape=circle,draw=black] (1) at (0,4) {$a_1$};
\node[shape=circle,draw=black](2) at (2,4){$b_1$};
\node[shape=circle,draw=black] (3) at (0,2) {$a_2$};
\node[shape=circle,draw=black](4) at (2,2){$b_2$};

\path[-] (1) edge  (2);
\path[-,line width=2pt,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}] (1) edge[decorate] (4);
\path[-] (3) edge (4);
\path[-,line width=2pt,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}] (3) edge[decorate] (2);

\node[](M1) at (9,3.5) {$M_1$ edges:};
\node[](m11) at (10,3.5){};
\node[](m12) at (11,3.5){};
\path[-](m11) edge(m12);
\node[](M2) at (9,3) {$M_2$ edges:};
\node[](m21) at (10,3){};
\node[](m22) at (11,3){};
\path[-,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}](m21) edge[decorate](m22);

\node[](a) at (5, 4) {$b_1 >_{a_1} b_2$};
\node[](b) at (5,3.5) {$\implies a_ 2 >_{b_1} a_1$};
\node[](c) at (5,3) {$\implies b_2 >_{a_2} b_1$};
\node[](d) at (5,2.5) {$\implies a_1 >_{b_2} a_2.$};

\end{tikzpicture}
\caption{Visualizing Lemma \ref{lemma:pref}. If any implication above doesn't hold, a blocking pair is found for the other matching.}
\end{figure}

\begin{lemma}\label{lemma:sym_stable} 
Let $M_1$ and $M_2$ be two stable matchings in $G$. Let $J_1$ be the union of $E(C)$ for connected components $C$ in $M_1 \triangle M_2$ satisfying~\eqref{eq:pref_first}, let $J_2:=(M_1\triangle M_2)\setminus C$. Then both $M_1\triangle J_1$ and $M_1\triangle J_2$ are stable matchings in $G$.
\end{lemma}
\begin{proof}
By Lemma~\ref{lemma:pref}, $J_2$ is the union of $E(C)$ for connected components $C$ in $M_1 \triangle M_2$ satisfying~\eqref{eq:pref_second}. Clearly $M'_1:=M_1\triangle J_1$ and $M'_2:=M_1\triangle J_2$ are matchings in $G$. Let us assume that one of these matchings is not stable, w.l.o.g. assume that $M'_1$ does not satisfy~\eqref{eq:stability_def} for some edge $e:=\{a,b\}\in E$ with $a\in\mathcal{A}$ and $b\in\mathcal{B}$. 

Since $M_1$ and $M_2$ are stable, we have $|\{a,b\}\cap V(J_1)|=1$ and $|\{a,b\}\cap V(J_2)|=1$.
If $a\in V(J_1)$ and $b\in V(J_2)$, then $M'_1(a)=M_2(a)$ and $M'_1(b)>_b M_2(b)$, and hence $M_2$ violates~\eqref{eq:stability_def} for $e:=\{a,b\}$. If $a\in V(J_2)$ and $b\in V(J_1)$, then $M'_1(a)=M_1(a)$ and $M'_1(b)>_b M_1(b)$, and hence $M_1$ violates~\eqref{eq:stability_def} for $e:=\{a,b\}$, contradiction.
\end{proof}

\begin{figure}[H]
\centering
\begin{tikzpicture}
\node[] (J1) at (0,6) {$J_1$:};

\node[shape=circle,draw=black] (1) at (0,4) {$a_1$};
\node[shape=circle,draw=black](2) at (2,4){$b_1$};
\node[shape=circle,draw=black] (3) at (0,2) {$a_2$};
\node[shape=circle,draw=black](4) at (2,2){$b_2$};

\path[-] (1) edge  (2);
\path[-,line width=2pt,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}] (1) edge[decorate] (4);
\path[-] (3) edge (4);
\path[-,line width=2pt,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}] (3) edge[decorate] (2);

\node[] (J2) at (5,6) {$J_2$:};

\node[shape=circle,draw=black] (5) at (5,4) {$a_3$};
\node[shape=circle,draw=black](6) at (7,4){$b_3$};
\node[shape=circle,draw=black] (7) at (5,2) {$a_4$};
\node[shape=circle,draw=black](8) at (7,2){$b_4$};

\path[-,line width=2pt] (5) edge  (6);
\path[-,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}] (5) edge[decorate] (8);
\path[-,line width=2pt] (7) edge (8);
\path[-,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}] (7) edge[decorate] (6);

\node[](M1) at (9,3.5) {$M_1$ edges:};
\node[](m11) at (10,3.5){};
\node[](m12) at (11,3.5){};
\path[-](m11) edge(m12);
\node[](M2) at (9,3) {$M_2$ edges:};
\node[](m21) at (10,3){};
\node[](m22) at (11,3){};
\path[-,decoration={zigzag,segment length=4,amplitude=.9,post=lineto,post length=2pt}](m21) edge[decorate](m22);
\node[](m1j1) at (9,2.5){$M_1\triangle J_1$ edges:};
\node[](bolded) at (11,2.5){$\textbf{bolded}$};

\node[]() at (0, 5) {$b_1 >_{a_1} b_2$};
\node[]() at (2, 5) {$a_2 >_{b_1} a_1$};
\node[]() at (0, 1) {$b_2 >_{a_1} b_1$};
\node[]() at (2,1) {$a_1 >_{b_2} a_2$};

\node[]() at (5, 5) {$b_4 >_{a_3} b_3$};
\node[]() at (7, 5) {$a_3 >_{b_3} a_4$};
\node[]() at (5, 1) {$b_3 >_{a_4} b_4$};
\node[]() at (7,1) {$a_4 >_{b_4} a_3$};

\path[dashed](4) edge (5);
\end{tikzpicture}
\caption{Visualizing Lemma \ref{lemma:sym_stable}. If $b_2a_3$ blocks $M_1 \triangle J_1$ then $b_2a_3$ blocks $M_1$.}
\end{figure}

\section{Stable Matching Polytope}

Let us define the \emph{stable matching polytope} $P(G)\subseteq\R^E$ for graph $G$ as follows
$$
	P(G):=\conv\{\chi(M)\in\R^E: M \text{ is a stable matching in } G\}\,.
$$
By~\cite{}, $P(G)$ is a nonempty polytope because every graph $G$ has a stable matching.

Clearly, the vertices of $P(G)$ are in one to one correspondence with stable matchings in $G$. Moreover, Lemma~\ref{lemma:sym_stable} helps to understand what pairs of stable matchings in $G$ do not correspond to edges of $P(G)$.

\begin{lemma}\label{lemma:edge}
Let $M_1$ and $M_2$ be two stable matchings in $G$ which define an edge of the polytope~$P(G)$. Then all connected components in $M_1\triangle M_2$ satisfy~\eqref{eq:pref_first} or all of them satisfy~\eqref{eq:pref_second}.  
\end{lemma}
\begin{proof}
If the statement of the lemma does not hold, then in Lemma~\ref{lemma:sym_stable} the sets $J_1$ and $J_2$ are both nonempty, and hence we obtain two stable matchings $M_1\triangle J_1$ and $M_1\triangle J_2$ different from $M_1$, $M_2$ such that $\frac{1}{2}\chi(M_1\triangle J_1)+\frac{1}{2}\chi(M_1\triangle J_2)=\frac{1}{2}\chi(M_1)+\frac{1}{2}\chi(M_2)$, what contradicts the statement that $M_1$ and $M_2$ define an edge of $P(G)$.
\end{proof}


\begin{corollary}\label{cor:edge}
Let $M_1$ and $M_2$ be two stable matchings in $G$ such that
$$
	M_1\cap\delta^{>a}(b)\neq\varnothing, M_1\cap\delta^{>b}(a)\neq\varnothing\quad\text{and}\quad M_2\cap\big(\delta^{>a}(b)\cup \delta^{>b}(a)\big)=\varnothing 
$$
 for some $a\in\mathcal{A}$ and $b\in\mathcal{B}$. Then, $M_1$ and $M_2$ do not define an edge of the polytope~$P(G)$.
\end{corollary}


\section{Linear Description}
Let us define $Q(G)\subseteq\R^E$ to be the polytope described  by the following linear constraints
\begin{align}
x(\delta(v)) \leq 1\,,\quad \forall v \in V\qquad \text{and} \qquad x_e \geq 0\,,\quad \forall e \in E\,,\label{eq:lin_descr_match}\\
x(\delta^{>a}(b))+ x(\delta^{>b}(a)) + x_{\{a,b\}} \geq 1\,, \quad \forall e:=\{a,b\} \in E \label{eq:lin_descr_stab}
\end{align}
where $x(J) = \sum_{e \in J} x_e$ for any $J \subseteq E$.

Clearly, $P(G)\subseteq Q(G)$ because for every stable matching $M$ in $G$ the point $x:=\chi(M)$  satisfies~\eqref{eq:lin_descr_match} and by~\eqref{eq:stability_def} the point $x$ also satisfies~\eqref{eq:lin_descr_stab}. On the other hand, every integral point in $Q(G)$ equals $\chi(M)$ for some stable matching $M$ in~$G$. In the remaining part of the paper we show that every vertex of $Q(G)$ is integral, thus proving the main theorem.

\begin{theorem}
	For every graph $G$ the polytope $P(G)$ equals $Q(G)$.
\end{theorem}


\begin{lemma}
	For every graph $G$ every vertex of the polytope $Q(G)$ is integral.
\end{lemma}
\begin{proof}
First, let us show that every vertex $x$ of $Q(G)$ has a coordinate equal to $0$ or a coordinate equal to $1$. Let us assume the contrary. As every vertex, $x\in \R^E$ is defined as the unique point, which tightly satisfies some $|E|$ constraints describing $Q(G)$. Since $x$ has no zero coordinate, we can assume  that the tight constraints are $x(\delta(v))\le 1$ for $v\in V_x$ and \eqref{eq:lin_descr_stab} for $e\in E_x$, where $|V_x|+|E_x|=|E|$. Moreover, let us assume that we choose the $|E|$ tight constraints so that $|V_x|$ is as large as possible. 

The constraints $x(\delta(v))=1$, $v\in V$ are linearly dependent, in particular $\sum_{a\in\mathcal{A}}\chi(\delta(a))=\sum_{b\in\mathcal{B}}\chi(\delta(b))$. Hence, we have $V_x\subsetneq V$. On the other hand if $a=N_{\max}(b)$ then $e:=\{a,b\}\not\in E_x$. Indeed, $a=N_{\max}(b)$ implies $\delta^{>a}(b)=\varnothing$ then
$$
	1\le x(\delta^{>a}(b))+ x(\delta^{>b}(a)) + x_{\{a,b\}}=x(\delta^{\ge b}(a)) \le x(\delta(a)) \le 1\,,
$$
showing that $\delta^{< b}(a)=\varnothing$ and hence $E_x\setminus e$, $V_x\cup \{a\}$ also define the vertex $x$. Analogously, we can show that if $b\in V_x$  and $a=N_{\min}(b)$ then $e:=\{a,b\}\not\in E_x$. Moreover, notice that $N_{\min}(v)\neq N_{\max}(v)$ for $v\in V_x$ since no coordinate of $x$ equals $1$. Thus, 
\begin{multline*}
	|E_x|=\frac{1}{2}\sum_{v\in V} |\delta(v)\cap E_x|\le \frac{1}{2}\sum_{v\in V_x} (|\delta(v)|-2)+\\\frac{1}{2}\sum_{v\in V\setminus V_x} (|\delta(v)|-1)= |E|-|V_x|-\frac{1}{2}|V\setminus V_x|\,,
\end{multline*}
what implies $|E_x|+|V_x|< |E|$, contradiction.

\bigskip

Now let us assume that $G$ is a graph with the minimum number of edges such that $Q(G)$ is not an integral polytope. Let $x$ be a nonintegral vertex of $Q(G)$.

Case $x_{\{a,b\}}=0$ for some $a\in \mathcal{A}$, $b\in\mathcal{B}$ and $e:=\{a,b\}\in E$. In this case, let $x'$ be obtained from $x$ by dropping the coordinate corresponding to $\{a,b\}$, and let $G'$ be the graph with $V(G')=V$ and $E(G')\setminus \{e\}$. Define $H'$ to be the hyperplane $\{x\in \R^{E(G')}: x(\delta^{>a}(b))+ x(\delta^{>b}(a))=1\}$. Then, $x'$ is a vertex of the polytope $P':=P(G')\cap H'$.
But every vertex of $P'$ is either a vertex of $P(G')$ or an intersection of an edge of $P(G')$ with the hyperplane $H'$. Since by Corollary~\ref{cor:edge} there is no edge of $P(G')$ intersecting the hyperplane $H'$, $x'$ is a vertex of $P(G')$. By minimality of $G$, both $x'$ and $x$ are integral, contradiction.

Case $x_{\{a,b\}}=1$ for some $a\in \mathcal{A}$, $b\in\mathcal{B}$. Let $x'$ be obtained by dropping the coordinates corresponding to $\delta(a)\cup\delta(b)$, and let $G'$ be the graph with $V(G')=V\setminus\{a,b\}$ and $E(G')\setminus \big(\delta(a)\cup\delta(b)\big)$. It is straightforward to see that $x'$ is a vertex of $P(G')$. Thus by minimality of $G$, both $x'$ and $x$ are integral, contradiction. 
\end{proof}


\bibliographystyle{alpha}
\bibliography{StableMatchingPolytopeReferences}
\end{document}
